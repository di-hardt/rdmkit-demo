{%- if include.filter %}
{%- assign allcountries = site.data.countries %}
{%- for current_page in site.pages | sorted %}
{%- if current_page.title and current_page.search_exclude != true and current_page.type == include.type %}
{%- if current_page.audience %}
{%- assign pageaudience = current_page.audience | join: ", " %}
{%- if allaudience %}
{%- assign allaudience = allaudience | append: ", " | append: pageaudience %}
{%- else %}
{%- assign allaudience = allaudience | append: pageaudience %}
{%- endif  %}
{%- endif %}
{%- endif %}
{%- endfor %}
{%- assign allaudience = allaudience | split: ", " | uniq | sort %}
<div class="btn-group" role="group" aria-label="Button group with nested dropdown">
    <div class="btn-group" role="group">
        <button class="btn bg-light hover-primary dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
        Filter by audience
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            {%- for affiliation in allaudience %}
            {%- if affiliation.size == 2 %}
            {%- assign country = affiliation | upcase %}
            <li><a class="dropdown-item" href="#">{{allcountries[country]}}</a></li>
            {%- else %}
            <li><a class="dropdown-item" href="#">{{affiliation}}</a></li>
            {%- endif %}
            {%- endfor %}
        </ul>
    </div>
    <div class="btn-group" role="group">
        <button class="btn bg-light hover-primary dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
        Filter by affiliation
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            {%- for affiliation in allaudience %}
            {%- if affiliation.size == 2 %}
            {%- assign country = affiliation | upcase %}
            <li><a class="dropdown-item" href="#">{{allcountries[country]}}</a></li>
            {%- else %}
            <li><a class="dropdown-item" href="#">{{affiliation}}</a></li>
            {%- endif %}
            {%- endfor %}
        </ul>
    </div>
    <button class="btn bg-light hover-primary" type="button" id="dropdownMenuButton3">
        Clear filters
    </button>
</div>
{%- endif %}
<div class="row row-cols-1 row-cols-md-2 g-4 mt-3 mb-5 navigation-tiles">
    {%- for current_page in site.pages | sorted %}
    {%- if current_page.title and current_page.search_exclude != true and current_page.type == include.type %}
    <div class="col">
        <div class="card h-100">
            <div class="card-header bg-dark">
                <a class="text-white" aria-label="Go to the {{current_page.title}} page" href="{{ current_page.url | relative_url }}"><h3 class="card-title m-0">{{current_page.title}}</h3></a>
            </div>
            <div class="card-body bg-light">
                {%- if current_page.description %}
                <p class="card-text">{{ current_page.description}}</p>
                {%- endif %}
                {%- if current_page.related_pages %}
                {%- for section in current_page.related_pages %}
                {%- unless section[1] == blank  %}
                <div>
                    <span><b><small>{{ section[0] | replace: "_", " " | capitalize }}: </small></b></span>
                    {%- for page_id in section[1] %}
                    {%- assign section_pages = site.pages | where:"type", section[0] %}
                    {%- assign metadata = section_pages | where:"page_id", page_id %}
                    {%- for page_hit in metadata %}
                    <a href="{{ page_hit.url | relative_url }}"><span class="badge fw-normal text-dark bg-white hover-primary">{{page_hit.title | truncate: 20 }}</span></a>
                    {%- endfor %}
                    {%- endfor %}
                </div>
                {%- endunless %}
                {%- endfor %}
                {%- endif %}
            </div>
            {%- if current_page.audience or current_page.affiliations %}
            {%- assign alllogos = site.data.affiliations %}
            {%- assign allcountries = site.data.countries %}
            <div class="card-footer bg-light border-top border-white border-3 d-flex align-middle">
                {%- if current_page.affiliations %}
                <div class="me-3">
                    <span class="me-2"><b><small>Affiliations:</small></b></span>
                    {%- for affiliation in current_page.affiliations %}
                    {%- assign filter_affiliation = alllogos | where: "name", affiliation %}
                    {%- if affiliation.size == 2 %}
                    {%- assign country = affiliation | upcase %}
                    <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{allcountries[country]}}">
                        <button class="btn btn-sm text-dark bg-white pe-none" title="{{allcountries[country]}}"><div class="flag-icon flag-icon-{{affiliation | downcase}} h-30px"></div></button>
                    </span>
                    {%- elsif affiliation == "ALL" %}
                    <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="All people">
                        <button class="btn btn-sm text-dark bg-white pe-none" title="ALL"><div class="h-30px">ALL</div></button>
                    </span>
                    {%- elsif filter_affiliation %}
                    {%- for result in filter_affiliation %}
                    <a role="button" href="{{result.url}}" data-bs-toggle="tooltip" data-bs-original-title="{{affiliation}}" class="btn btn-sm bg-white hover-primary"><img alt="logo of {{result.name}}" src="{{result.image_url | relative_url }}" class="d-inline h-30px"></a>
                    {%- endfor %}
                    {%- endif %}
                    {%- endfor %}
                </div>
                {%- endif %}
                {%- if current_page.audience %}
                <div>
                    <span class="me-2"><b><small>Audience:</small></b></span>
                    {%- for audience in current_page.audience %}
                    {%- assign filter_audience = alllogos | where: "name", audience %}
                    {%- if audience.size == 2 %}
                    {%- assign country = audience | upcase  %}
                    <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="{{allcountries[country]}}">
                        <button class="btn btn-sm text-dark bg-white pe-none" title="{{allcountries[country]}}"><div class="flag-icon flag-icon-{{audience | downcase}} h-30px"></div></button>
                    </span>
                    {%- elsif audience == "ALL" %}
                    <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" title="All people">
                        <button class="btn btn-sm text-dark bg-white pe-none" title="ALL"><div class="h-30px">ALL</div></button>
                    </span>
                    {%- elsif filter_audience %}
                    {%- for result in filter_audience %}
                    <a  role="button" href="{{result.url}}" data-bs-toggle="tooltip" data-bs-original-title="{{affiliation}}" class="btn btn-sm bg-white hover-primary"><img alt="logo of {{result.name}}" src="{{result.image_url | relative_url }}" class="d-inline h-30px"></a>
                    {%- endfor %}
                    {%- endif %}
                    {%- endfor %}
                </div>
                {%- endif %}
            </div>
            {%- endif %}
        </div>
    </div>
    {%- endif %}
    {%- endfor %}
</div>